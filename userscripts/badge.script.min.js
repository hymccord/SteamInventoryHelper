var buyingExp=/javascript:BuyMarketListing\('listing', '(\d+)', (\d+), '(\d+)', '(\d+)'\)/;BuyCardSetDialog={m_bInitialized:!1,m_oItemsToBuy:[],m_fnDocumentKeyHandler:null,m_total:0,b_buyall:!1,Initialize:function(){$("market_buycardset_dialog_cancel").observe("click",this.OnCancel.bindAsEventListener(this));$("market_buycardset_dialog_reload").observe("click",this.OnReload.bindAsEventListener(this));$("market_buycardset_dialog_buyall").observe("click",this.OnBuyAll.bindAsEventListener(this));$("market_buycardset_dialog").style.visibility="hidden";$("market_buycardset_dialog").show();$("market_buycardset_dialog").hide();$("market_buycardset_dialog").style.visibility="";this.m_bInitialized=!0},Show:function(n){(this.m_bInitialized||this.Initialize(),n.length!=0)&&(m_oItemsToBuy=n,this.m_fnDocumentKeyHandler=this.OnDocumentKeyPress.bindAsEventListener(this),$(document).observe("keydown",this.m_fnDocumentKeyHandler),showModal("market_buycardset_dialog",!0),this.OnReload({stop:function(){}}))},RemoveItem:function(n){var t,i;for(console.log(n),t=0;t<m_oItemsToBuy.length;t++)if(i=m_oItemsToBuy[t],i.link===n){m_oItemsToBuy.splice(t,1);m_oItemsToBuy.length===0&&window.location.reload();return}},BuyFirstCard:function(){var n=$J('#lstParts a.item_market_action_button.item_market_action_button_green:contains("'+SIHLang.quickbuy+'")');n.length>0&&($J(n[0]).trigger("click"),$J(n[0]).prop("disabled",!0))},Dismiss:function(){$(document).stopObserving("keydown",this.m_fnDocumentKeyHandler);hideModal("market_buycardset_dialog")},OnCancel:function(n){this.Dismiss();n.stop()},OnAccept:function(n){n.stop()},OnReload:function(n){var t,i;for(n.stop(),BuyCardSetDialog.m_total=0,$J("#lstParts").html('<img src="'+window.location.protocol+'//steamcommunity-a.akamaihd.net/public/images/login/throbber.gif" class="loading" alt="Working...">'),t=0;t<m_oItemsToBuy.length;t++)i=m_oItemsToBuy[t],$J.get(i.link+"/render/?query=&start=0&count=1&country="+g_rgWalletInfo.wallet_country+"&language="+g_strLanguage+"&currency="+g_rgWalletInfo.wallet_currency,function(n){if($J("#lstParts").find("img.loading").remove(),n.success){var t=$J(n.results_html),i=this.url.substring(0,this.url.indexOf("/render/")),r=getNumber(t.find(".market_listing_price.market_listing_price_with_fee").html().trim());BuyCardSetDialog.m_total+=parseFloat(r);$J("#market_buycardset_dialog_buyall span").text(SIHLang.tradingcards.buyall+" ("+formatNumber(BuyCardSetDialog.m_total)+")");t.find(".market_listing_right_cell.market_listing_their_price .market_table_value").css("margin-top","30px");t.find(".market_listing_buy_button").data("link",i);$J("#lstParts").append(t);$J("#lstParts").find(".market_listing_table_header").remove();t.find("a.item_market_action_button.item_market_action_button_green").each(function(){var t=$J(this).parents(".market_listing_row"),i=buyingExp.exec($J(this).attr("href"));i&&($J(this).attr("href","#"),$J(this).find(".item_market_action_button_contents").html(SIHLang.quickbuy),$J(this).click(function(){$J(this).hide();var u={listingid:i[1],appid:i[2],contextid:i[3],id:i[4]},r=n.listinginfo[u.listingid],f={sessionid:g_sessionID,currency:g_rgWalletInfo.wallet_currency,subtotal:r.converted_price,fee:r.converted_fee,total:r.converted_price+r.converted_fee,quantity:1};return t.find(".market_listing_buy_button").append('<img src="'+window.location.protocol+'//steamcommunity-a.akamaihd.net/public/images/login/throbber.gif" alt="Working...">'),$J.ajax({url:"https://steamcommunity.com/market/buylisting/"+u.listingid,type:"POST",data:f,crossDomain:!0,xhrFields:{withCredentials:!0}}).done(function(){t.is(":visible")?t.find(".market_listing_buy_button").html("Success"):alert("Success");var n=t.find(".market_listing_buy_button").data("link");BuyCardSetDialog.RemoveItem(n)}).fail(function(n){t.find(".market_listing_buy_button img").remove();var i=$J.parseJSON(n.responseText);i&&i.message&&console.log(i.message);t.find(".market_listing_buy_button").html("Error")}).always(function(){BuyCardSetDialog.b_buyall&&BuyCardSetDialog.BuyFirstCard()}),!1}))})}})},OnBuyAll:function(n){n.stop();this.b_buyall=!0;this.BuyFirstCard()},OnDocumentKeyPress:function(n){n.keyCode==Event.KEY_ESC&&(this.Dismiss(),n.stop())}};var AddBuyCardSet=function(){var n='<div id="market_buycardset_dialog" class="market_modal_dialog" style="display: none;"><div class="market_dialog_title"><span id="market_buycardset_dialog_title" data-lang="tradingcards.dialogtitle" >'+SIHLang.tradingcards.dialogtitle+'<\/span><span class="market_dialog_cancel"><a id="market_buycardset_dialog_cancel" href="#" class="market_dialog_title_cancel">Cancel<span class="market_dialog_title_cancel_X">X<\/span><\/a><\/span><\/div><div class="market_dialog_contents"><div class="market_dialog_content_frame"><div class="market_dialog_content"><div class="market_dialog_iteminfo"><div id="lstParts" class="market_content_block market_home_listing_table market_home_main_listing_table market_listing_table"><\/div><\/div><\/div><div class="market_dialog_content_separator"><\/div><div class="market_dialog_content market_dialog_content_dark"><div class="market_sell_dialog_input_area"><a id="market_buycardset_dialog_buyall" href="#" class="btn_green_white_innerfade btn_small_wide" style="margin-right:10px"><span>'+SIHLang.tradingcards.buyall+'<\/span><\/a><a id="market_buycardset_dialog_reload" href="#" class="btn_green_white_innerfade btn_small_wide"><span data-lang="tradingcards.reload">'+SIHLang.tradingcards.buyall+"<\/span><\/a><div>&nbsp;<br /><br /><\/div><\/div><\/div><\/div><\/div><\/div>";n+='<div id="hover" style="display: none; z-index: 1000"><div class="shadow_ul"><\/div><div class="shadow_top"><\/div><div class="shadow_ur"><\/div><div class="shadow_left"><\/div><div class="shadow_right"><\/div><div class="shadow_bl"><\/div><div class="shadow_bottom"><\/div><div class="shadow_br"><\/div> <div class="inventory_iteminfo hover_box shadow_content" id="iteminfo_clienthover"><div class="item_desc_content" id="hover_content"><div class="item_desc_icon"><div class="item_desc_icon_center"><img id="hover_item_icon" src="'+window.location.protocol+'//steamcommunity-a.akamaihd.net/public/images/trans.gif" alt="" /><\/div><\/div><div class="item_desc_description"><h1 class="hover_item_name" id="hover_item_name"><\/h1><div class="fraud_warning" id="hover_fraud_warnings"><\/div><div class="item_desc_game_info" id="hover_game_info"><div class="item_desc_game_icon"><img id="hover_game_icon" src="'+window.location.protocol+'//steamcommunity-a.akamaihd.net/public/images/trans.gif" alt="" /><\/div><div id="hover_game_name" class="ellipsis"><\/div><div id="hover_item_type" class=""><\/div><\/div><div class="item_desc_descriptors" id="hover_item_descriptors"><\/div><div class="item_desc_descriptors" id="hover_item_owner_descriptors"><\/div><\/div><\/div><\/div><div class="hover_arrow_left" id="hover_arrow_left"><div class="hover_arrow_inner"><\/div><\/div><div class="hover_arrow_right" id="hover_arrow_right"><div class="hover_arrow_inner"><\/div><\/div><\/div>';$J("body").append(n)},g_rgWalletInfo=null,g_strLanguage="english",g_rgAppContextData={},missingCards=[];setTimeout(function(){var n=$J(".badge_card_to_collect_links"),t;n.length<1||($J(".gamecards_inventorylink").append('<a class="btn_grey_grey btn_small_thin" id="bt_buyMissings" href="javascript:void(0)"><span data-lang="tradingcards.showpopup">'+SIHLang.tradingcards.showpopup+"<\/span><\/a>"),t=$J(".popup_menu_item.header_notification_items").attr("href"),$J.ajax({url:t,success:function(res){var expWallet=/g_rgWalletInfo = .+?;/,m=expWallet.exec(res);m&&eval(m[0]);m=/g_strLanguage = .+?;/.exec(res);m&&eval(m[0])}}),missingCards=[],n.each(function(){var n=$J(this).find('a[href*="/market/listings/"]');n.length<1||missingCards.push({link:n.attr("href")})}),AddBuyCardSet(),$J("#bt_buyMissings").click(function(){BuyCardSetDialog.Show(missingCards)}),ReloadLang())},10);
/*
//# sourceMappingURL=badge.script.min.js.map
*/