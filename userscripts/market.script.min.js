var FraudAlert=function(){$J("#sellListingRows .market_listing_row.market_recent_listing_row[id]").each(function(){var t=$J(this),f=$J(this).attr("id").replace("listing_sell_new_",""),n=g_rgListingInfo[f],i=null,r,e,u;if(n)i=g_rgListingInfo[f].asset;else return;r=g_rgAssets[i.appid][i.contextid][i.id];r.fraudwarnings&&r.fraudwarnings.length>0&&(e=$J(this).find(".market_listing_item_name"),e.html(e.html()+' <span style="color:red">(warning)<\/red>'));n.price>0&&(u=$J('<a href="#" class="item_market_action_button item_market_action_button_green"><span class="item_market_action_button_edge item_market_action_button_left"><\/span><span class="item_market_action_button_contents">'+SIHLang.quickbuy+'<\/span><span class="item_market_action_button_edge item_market_action_button_right"><\/span><span class="item_market_action_button_preload"><\/span><\/a>'),u.click(function(){$J(this).hide();t.find(".market_listing_buy_button").append('<img src="'+window.location.protocol+'//steamcommunity-a.akamaihd.net/public/images/login/throbber.gif" alt="Working...">');var i=n.converted_price,r=n.converted_fee,u=n.converted_price+n.converted_fee,e={sessionid:g_sessionID,currency:g_rgWalletInfo.wallet_currency,subtotal:i,fee:r,total:u,quantity:1};return $J.ajax({url:"https://steamcommunity.com/market/buylisting/"+f,type:"POST",data:e,crossDomain:!0,xhrFields:{withCredentials:!0}}).done(function(){t.is(":visible")?t.find(".market_listing_buy_button").html("Success"):alert("Success")}).fail(function(n){t.find(".market_listing_buy_button img").remove();var i=$J.parseJSON(n.responseText);i&&i.message&&t.find(".market_listing_buy_button").html(i.message)}),!1}),AddItemHoverToElement(u[0],r),$J(this).find(".market_listing_buy_button .item_market_action_button.item_market_action_button_green").remove(),$J(this).find(".market_listing_buy_button").append(u))})},RemoveListing=function(){var t=$J(".market_listing_row .select-checkbox:visible:checked"),n,i;return t.length>0&&(n=$J(t[0]).parents(".market_recent_listing_row").attr("id"),i=n.substring(10),$J("#"+n+" .market_listing_right_cell.market_listing_edit_buttons").html("Removing..."),new Ajax.Request(window.location.protocol+"//steamcommunity.com/market/removelisting/"+i,{method:"post",parameters:{sessionid:g_sessionID},onSuccess:function(){$J("#"+n).hide(300,function(){$J("#"+n).remove();RemoveListing()})},onFailure:function(){$J("#"+n).hide(300,function(){$J("#"+n).remove()})}})),!1},isReloading=!1,ReloadListings=function(){isReloading||(isReloading=!0,$J("#tabContentsMyListings").html('<div style="text-align: center; padding: 20px"><img src="'+window.location.protocol+'//steamcommunity-a.akamaihd.net/public/images/login/throbber.gif" alt="Working..."><\/div>'),$J.ajax({url:"/market/mylistings/",success:function(res){res.success&&typeof res.num_active_listings!="undefined"&&(clearCachePrices(),MergeWithAssetArray(res.assets),$J("#tabContentsMyListings").html(res.results_html),$J("#my_market_activelistings_number").html(res.num_active_listings),eval(res.hovers),UpdateTotalListings(),AddFilter())},error:function(){$J("#tabContentsMyListings").html('<div style="text-align: center; padding: 20px">Error<\/div>')},complete:function(){isReloading=!1}}))},AddFilter=function(){var n=$J('<div style="clear:both; height: 32px"><div class="filter_ctn inventory_filters"><div style="float:left; line-height: 29px; width: 100px" >Filter: <\/div><div class="filter_control_ctn"><div id="filter_clear_btn" style="display: none;"><\/div><input class="selectableText filter_search_box" type="text" id="Txt_Filter" value="" placeholder="Start typing an item name here to filter items" name="filter" autocomplete="off"><\/div><\/div><\/div>'),t;n.find("#Txt_Filter").keyup(function(){var t=$J(this).val().toUpperCase().split(" ").filter(function(n){return n!=""}),i,n;if(t.length==0)$J("#tabContentsMyListings .market_home_listing_table:eq(0) .market_listing_row").show(),$J("#filter_clear_btn").hide();else{for(i="",n=0;n<t.length;n++)i+=':Contains("'+t[n]+'")';$J("#filter_clear_btn").show();$J("#tabContentsMyListings .market_home_listing_table:eq(0) .market_listing_row").each(function(){$J(this).is(i)?$J(this).show():$J(this).hide()})}});n.find("#filter_clear_btn").click(function(){n.find("#Txt_Filter").val("");$J("#tabContentsMyListings .market_home_listing_table:eq(0) .market_listing_row").show();$J("#filter_clear_btn").hide()});$J("#tabContentsMyListings .market_home_listing_table:eq(0) .my_market_header").after(n);t=$J('<input type="checkbox" class="select-checkbox" />');t.click(function(){var n=$J(this).prop("checked");$J("#tabContentsMyListings .market_home_listing_table:eq(0) .market_listing_edit_buttons .market_listing_cancel_button .select-checkbox:visible").prop("checked",n)});$J("#tabContentsMyListings .market_home_listing_table:eq(0) .market_listing_table_header .market_listing_edit_buttons").append(t);$J("#tabContentsMyListings .market_home_listing_table:eq(0) .market_listing_edit_buttons .market_listing_cancel_button").append('<input type="checkbox" class="select-checkbox" />')},UpdateTotalListings=function(){var n=$J("#tabContentsMyListings .market_content_block.my_listing_section.market_home_listing_table:first-child .market_listing_table_header"),t,i,r;n.find("> span").each(function(){var t;($J(this).is(":contains('NAME')")||$J(this).is(":contains('PRICE')"))&&($J(this).addClass("market_sortable_column"),$J(this).css("display","block"),$J(this).append('<span class="market_sort_arrow" style="display:none"><\/span>'),$J(this).is(":contains('NAME')")&&(t=$J(this),$J(this).click(function(){var i,r,u;n.find(".market_sort_arrow").hide();i=1;t.find(".market_sort_arrow").is(':contains("▲")')?(i=-1,t.find(".market_sort_arrow").text("▼")):t.find(".market_sort_arrow").text("▲");t.find(".market_sort_arrow").show();r=n.parent(".market_home_listing_table");u=r.children(".market_listing_row[id]");u.sort(function(n,t){var r=$J(n).find(".market_listing_item_name_link").text(),u=$J(t).find(".market_listing_item_name_link").text();return r>u?1*i:r<u?-1*i:0});u.detach().appendTo(r)})),$J(this).is(":contains('PRICE')")&&(t=$J(this),$J(this).click(function(){var i,r,u;n.find(".market_sort_arrow").hide();i=1;t.find(".market_sort_arrow").is(':contains("▲")')?(i=-1,t.find(".market_sort_arrow").text("▼")):t.find(".market_sort_arrow").text("▲");t.find(".market_sort_arrow").show();r=n.parent(".market_home_listing_table");u=r.children(".market_listing_row[id]");u.sort(function(n,t){var r=parseFloat(/[\d\.]+/.exec($J(n).find('[title="This is the price the buyer pays."]').text())[0]),u=parseFloat(/[\d\.]+/.exec($J(t).find('[title="This is the price the buyer pays."]').text())[0]);return(r==u&&(r=$J(n).find(".market_listing_item_name_link").text(),u=$J(t).find(".market_listing_item_name_link").text()),r>u)?1*i:r<u?-1*i:0});u.detach().appendTo(r)})))});t=0;i=0;(typeof totalrow=="undefined"||window.totalrow)&&($J("#myListings .market_content_block.my_listing_section.market_home_listing_table:first-child .market_listing_price span span:nth-child(1)").each(function(){var n=parseFloat(/[\d\.]+/.exec($J(this).text())[0]);isNaN(n)||(t+=n)}),$J("#myListings .market_content_block.my_listing_section.market_home_listing_table:first-child .market_listing_price span span:nth-child(3)").each(function(){var n=parseFloat(/[\d\.]+/.exec($J(this).text())[0]);isNaN(n)||(i+=n)}),r=$J('<div class="market_listing_row market_recent_listing_row"><div class="market_listing_right_cell market_listing_edit_buttons">&nbsp;<\/div><div class="market_listing_right_cell market_listing_my_price"><span class="market_table_value"><span class="market_listing_price"><span style="display: inline-block"><span>'+parseInt(t*100)/100+'<\/span><br /><span style="color: #AFAFAF">('+parseInt(i*100)/100+")<\/span><span><\/span><\/span><\/div><\/div>"),$J("#myListings .market_content_block.my_listing_section.market_home_listing_table:first-child:first-child .market_listing_table_header").after(r))};$J(function(){var t=CreateMarketActionButton("green","javascript:void(0)","Remove selected"),n;$J(t).click(function(){RemoveListing()});$J(".pick_and_sell_button").append(t);n=CreateMarketActionButton("green","javascript:void(0)","Reload listings (alt + R)");$J(n).attr("accesskey","r");$J(n).click(function(){ReloadListings()});$J(".pick_and_sell_button").prepend(n);jQuery.expr[":"].Contains=jQuery.expr.createPseudo(function(n){return function(t){return jQuery(t).text().toUpperCase().indexOf(n.toUpperCase())>=0}});UpdateTotalListings();AddFilter();LoadRecentListings&&(LoadRecentListings=function(n,t,i){if(!g_bBusyLoadingMore){var u=$(n),r=$(i);g_bBusyLoadingMore=!0;new Ajax.Request(window.location.protocol+"//steamcommunity.com/market/recent",{method:"get",parameters:{country:g_strCountryCode,language:g_strLanguage,currency:typeof g_rgWalletInfo!="undefined"?g_rgWalletInfo.wallet_currency:1},onSuccess:function(transport){if(transport.responseJSON){var response=transport.responseJSON;response.assets.length!=0&&(g_rgRecents[t].time=response.last_time,g_rgRecents[t].listing=response.last_listing,$J("#"+i).empty(),r.insert({bottom:response.results_html}),MergeWithAssetArray(response.assets),MergeWithListingInfoArray(response.listinginfo),MergeWithAppDataArray(response.app_data),eval(response.hovers))}},onComplete:function(){g_bBusyLoadingMore=!1;t==="sell_new"&&FraudAlert()}})}});$J("#sellListingsMore").html("Show more (alt + S)");$J("#sellListingsMore").attr("accesskey","s")});var cacheHist={lastIdx:-1,lastCount:-1},missingIdx=[],cacheSales={plus:{},minus:{}},_maxSize=1e3,totalPlus=0,totalMinus=0,regHis=/<div class="market_listing_left_cell market_listing_gainorloss">\s+?([\+\-])\s+?<\/div>[\s\S]+?<span class="market_listing_price">([\s\S]+?)<\/span>[\s\S]+?<div class="market_listing_right_cell market_listing_listed_date">([\s\S]+?)<\/div>/gmi,ProcessPriceData=function(n){for(var i,r=n.results_html;i=regHis.exec(r);){var u=i[1].trim(),f=i[2].trim(),e=i[3].trim(),t=/([\d\.,]+)/.exec(f.replace(/\&#.+?;/g,"").replace(" p&#1091;&#1073;.","").replace(/\s/,""));t=t?t[1].replace(/,(\d\d)$/g,".$1").replace(/.(\d\d\d)/g,"$1"):0;u==="-"?totalMinus+=parseFloat(t):totalPlus+=parseFloat(t)}totalMinus=parseFloat(totalMinus.toFixed(2));totalPlus=parseFloat(totalPlus.toFixed(2));console.log("Total",totalMinus+" "+totalPlus);setTimeout(function(){GetPriceHistory(cacheHist.lastIdx+_maxSize)},5e3)},GetPriceHistory=function(n){if(typeof n!="undefined"){var t=cacheHist.lastCount-n<_maxSize?cacheHist.lastCount-n:_maxSize,i=cacheHist.lastCount-n-t;if(t<=0)return;console.log("Get history: "+i+" - "+t);$J.ajax({url:"http://steamcommunity.com/market/myhistory/render/",data:{start:i,count:t},success:function(t){t.success?(cacheHist.lastCount=t.total_count,cacheHist.lastIdx=n,ProcessPriceData(t)):setTimeout(function(){GetPriceHistory(n)},500)}})}else console.log("Init get history"),totalPlus=0,totalMinus=0,$J.ajax({url:"http://steamcommunity.com/market/myhistory/render/?start=0&count=1",success:function(n){n.success&&(cacheHist.lastCount=n.total_count,setTimeout(function(){GetPriceHistory(0)},500))}})};
/*
//# sourceMappingURL=market.script.min.js.map
*/